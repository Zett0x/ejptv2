Para ver los usuarios del sistema:
`net users`
Para ver los miembros del grupo **administrators**:
`net localgroup administrators`
Si el usuario está en el grupo **administrators**, es posible ejecutar un bypass de UAC
El nivel de UAC debe estar en default, que es alto. Tras la instalación es el que está por defecto.

Repositorio: https://github.com/hfiref0x/UACME
## Compilación


Pasos: https://www.youtube.com/watch?v=iOEaKEb9lOE
1.- Abrir el IDE Visual Studio > clone repository: https://github.com/hfiref0x/UACME
2.- Abres "NanoDesu":
	1.- Seleccionas Release y x64. Click derecho en Akatsuki y build.
	2.- Seleccionas Release y x64. Click derecho en Fubuki y build. Cambiar a win32 y compilar también.
	3.- Release y x64. Build Naka. Usaremos Naka para comprimir y encriptar otros módulos.
	
3.- Abres explorador de archivos y vas a la ruta del repositorio donde esta Naka>output>x64>Release y ahí está el binario compilado. Abrir un cmd en esta ubicación.
4.- Vamos a ejecutar Naka.64.exe y pasarle las dlls de otros módulos.
	1.- Modulo akatsuki.dll
	![[Pasted image 20250206173414.png]]
	2.- Lo mismo para Fubuki (versionx64 y x32) y lo mismo para otro fichero encontrado en source>kamikaze>kamikaze.msc.
	![[Pasted image 20250206173656.png]]

NOTA: Para facilitar esto, vamos desde el explorador de archivos a las diferentes ubicaciones, hacemos clic der sobre el fichero y copiamos la ruta y ya la pegamos en el cmd como parámetro del ejecutable Naka64.exe

Si nos vamos a la ubicación del binario compilado Naka64.exe, veremos que ha creado ficheros con extension .cd y .key de cada módulo. Es decir, akatsuki.cd y akatsuki.key, fubuki64.cd y key... y asi para todos.

5.- Ejecutamos `Naka64.exe --stable`. Nos generará en la ubicación dónde es ejecutado dos ficheros más: secrets32.bin y secrets64.bin

6.- Copiamos todos los ficheros generados (SÓLO los .cd  de cada módulo y los otros dos generados secrets32.bin  y 64.bin)  y los llevamos al directorio del repositorio Source>Akagi>bin. Ya habrá ahí unos ficheros con el mismo nombre que los que hemos copiado, pero no están comprimidos ni encriptados así que pegamos y reemplazamos.
![[Pasted image 20250206174512.png]]

7.- Volvemos a Visual Studio , click der en Akagi y build. Listo ya tenemos el ejecutable final que será el que usemos para bypass el UAC de windows. No distribuir.


## Uso

Leer el README del repositorio de UACME. Hay un apartado de uso, básicamente el comando es el siguiente:
Run executable from command line: akagi32 [Key] [Param] or akagi64 [Key] [Param]
Ejemplos:
	1: akagi32.exe 23
	2: akagi32.exe 33 <ruta a un payload creado por msfvenom>

Si vamos a usar la ruta a un payload creado, antes nos ponemos en escucha con el módulo de multi handler de metasploit en el caso de meterpreter.


El parámetro de la key es el método que se utilizará para bypass la UAC. Dependiendo de la versión de windows funcionará o no. Leer ese apartado del readme y elegir el método en función de la versión del windows víctima. El que aconseja para windows 10 el profesor es el 33.

Cuando obtengamos la conexión, si usamos el comando getprivs veremos que tenemos más permisos a pesar de seguir con el mismo usuario. Pero podemos migrar el proceso a alguno cuyo usuario ejecutando sea NT Authority system tal como lsass.exe. 
Ejecutamos comando `ps` en meterpreter y vemos los procesos, vemos el ID de lsass.exe y usamos el comando migrate <id> y listo ya seremos NT Authority system.
