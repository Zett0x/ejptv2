
# Módulo Incognito en Meterpreter

## ¿Qué es Incognito?

- **Incognito** es un módulo de **Meterpreter** dentro de **Metasploit** que originalmente era una aplicación independiente.  
- Permite **suplantar tokens de usuario** después de una explotación exitosa.  

## Uso de Incognito
- Podemos utilizar el módulo **Incognito** para **listar** los tokens disponibles que podemos suplantar.  
Hace falta tener uno o más de los privilegios como SeImpersonatePrivilege, SeAssignPrimaryToken, SeCreateToken. Para poder suplantar existosamente.

### Pasos para la suplantación de un token:
1. Tener una sessión de meterpreter. Comprobar con el comando `getprivs` si tenemos alguno de los privilegios necesarios para la suplantación.
2. Cargar el módulo de meterpreter incognito con el comando `load incognito`
3. Listar tokens de usuarios `list_tokens -u`
4. Veremos los token clasificados en dos delegate tokens y impersonate tokens. Los delegate son generados como resultado de un login interactivo.
5. Suplantamos la identidad de un usuario usando su delegate token generado con el comando: `impersonate <nombre del token>`![[Pasted image 20250207122411.png]]
6. Migramos la session de meterpreter al proceso de explorer.exe con `pgrep explorer` y `migrate <id process>`
7. `getprivs` Ahora vemos que tenemos más permisos, los del usuario administrator. getuid para ver que usuario somos.
8. si listamos los tokens ahora, veremos que al elevar los privilegios tenemos más disponibles. Podemos intentar impersonar un token de acceso de NT AUTHORITY\SYSTEM.![[Pasted image 20250207123056.png]]

**NOTA**: Si estamos en la situación que listamos los tokens de acceso y no hay disponibles ni delegate ni impersonate; tendremos que usar the potato attack , lo que hace es generar un NT authority system access token que podremos suplantar.
 