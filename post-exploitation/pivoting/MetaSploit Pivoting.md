Una vez hemos vulnerado un sistema, podemos comprobar si ese sistema est√° conectado a otra red por medio de otra interfaz.
Si el sistema es linux usamos ifconfig si es windows ipconfig.
## **Pivoting con Metasploit y ProxyChains - Resumen R√°pido** üöÄ

1Ô∏è‚É£ **Identificar redes adicionales** en la m√°quina comprometida:

`ifconfig  # Linux   
`ipconfig  # Windows`
2Ô∏è‚É£ **A√±adir la ruta en Metasploit** para redirigir tr√°fico a la red pivotada:
`run autoroute -s <ip>/20
`background`
3Ô∏è‚É£ **Levantar un servidor SOCKS en Metasploit:**

use auxiliary/server/socks_proxy
set VERSION 4a
set SRVPORT 9050
exploit

4Ô∏è‚É£ **Configurar ProxyChains** en el atacante (`/etc/proxychains4.conf`) SI ya est√° configurado no tocar:

socks4  127.0.0.1 9050

5Ô∏è‚É£ **Usar herramientas a trav√©s del t√∫nel SOCKS:**

`proxychains nmap -sS -Pn -n -p- -sVC --open -T4 -v 10.10.10.100 -oN scan`

`proxychains smbclient -L \\10.10.10.100 -U usuario`


## Largo

Supongamos que hemos encontrado otra interfaz de red conectada a la 10.10.10.0/24.
Dentro de la consola meterpreter a√±adimos la ruta:
`run autoroute -s 10.10.10.0/24`
Entonces ya sabe meterpreter que para enviar paquetes a esa red deber√° de pasar por el host vulnerado.

Despues usamos `background` para poner la session meterpreter en segundo plano.
Comprobamos versi√≥n de proxychains y configuraci√≥n:
`cat /etc/proxychains4.conf`
o puede ser sin el 4. En esa configuraci√≥n te dice el puerto en el que funciona ![[Pasted image 20250212121704.png]]


usaremos un m√≥dulo proxy `auxiliary/server/socks_proxy`. Lo configuramos seg√∫n nuestra version de socks y puerto.
![[Pasted image 20250212121847.png]]


1. SET VERSION 4a
2. SET SRVPORT 9050
3. exploit
![[Pasted image 20250212121954.png]]

Podemos comprobar si est√° funcionando el proxy con:
`netstat -antp` y veremos que se est√° escuchando en el puerto 9050
![[Pasted image 20250212122121.png]]

Ahora podremos ejecutar un scan nmap sobre la m√°quina (demo1.ine.local) que est√° en una red que solo ten√≠a acceso a trav√©s de otra interfaz la m√°quina que usamos de pivoting (demo.ine.local)

`proxy chains nmap -sS -Pn -n -p- -sVC --open -T4 -v demo1.ine.local -oN scan`

## Comandos dentro de la m√°quina windows pivoting.

### Mostrar los recursos compartidos de otra m√°quina:
`net view demo1.ine.local`
![[Pasted image 20250212122944.png]]


Si nos da acceso denegado, migrar el proceso meterpreter a otro con mayores privilegios:
si migras a lsass.exe no funciona el net view no se porque
`migrate -N explorer.exe`

![[Pasted image 20250212122754.png]]


### Usar recursos
Para usar un recurso en concreto:
![[Pasted image 20250212123027.png]]
Entonces ya tendremos disponible para usarlo, y lo hemos a√±adido a D: pero podr√≠amos poner otra letra.
![[Pasted image 20250212123152.png]]

Y listarlo:
![[Pasted image 20250212123244.png]]
